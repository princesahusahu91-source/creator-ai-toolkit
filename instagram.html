<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instagram Auto DM</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body{font-family:Inter,system-ui;background:#f6f9ff;margin:0}
    .container{max-width:900px;margin:0 auto;padding:22px}
    h1{margin:0 0 6px}
    .muted{color:#6b7280;font-size:13px}
    .card{background:#fff;border:1px solid #e6ebf5;border-radius:14px;padding:16px;margin-top:14px}
    label{font-weight:600;font-size:13px}
    input, textarea{
      width:100%; padding:10px; border-radius:10px;
      border:1px solid #e6ebf5; outline:none; margin-top:6px;
      font-family:Inter,system-ui;
    }
    textarea{min-height:90px; resize:vertical}
    .btn{
      margin-top:12px; padding:10px 14px; border-radius:10px;
      border:none; background:#2563eb; color:#fff; font-weight:600;
      cursor:pointer;
    }
    .btn.secondary{background:#e5edff;color:#1d4ed8}
    .row{display:grid; gap:12px}
    @media(min-width:768px){.row{grid-template-columns:1fr 1fr}}
    .log{font-size:13px; color:#334155; margin-top:8px}
    .pill{
      display:inline-block; padding:4px 10px; border-radius:999px;
      background:#eef2ff; color:#1d4ed8; font-size:12px; font-weight:600; margin-right:6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì© Instagram Auto DM (MVP)</h1>
    <p class="muted">Auto-reply to comments with DMs (simulated). Real automation needs Instagram API / webhook.</p>

    <div class="card">
      <label>Trigger Keywords (comma separated)</label>
      <input id="keywords" placeholder="price, ebook, link" />

      <label style="margin-top:10px;">Auto DM Message</label>
      <textarea id="message" placeholder="Hey! Thanks for commenting üòä Here‚Äôs the link: https://..."></textarea>

      <button class="btn" onclick="saveConfig()">Save Settings</button>
    </div>

    <div class="card">
      <h3>üß™ Test Automation (Simulate Comment)</h3>
      <div class="row">
        <input id="comment" placeholder="User comment e.g. 'price pls'" />
        <input id="username" placeholder="Username e.g. @rahul" />
      </div>
      <button class="btn secondary" onclick="simulate()">Simulate DM</button>
      <div id="result" class="log"></div>
    </div>

    <div class="card">
      <h3>üì• Leads Collected</h3>
      <div id="leads" class="log"></div>
    </div>
  </div>

  <!-- üî• Firebase -->
  <script src="firebase.js" type="module"></script>

  <!-- üîê Auth Guard -->
  <script type="module">
    const { auth, onAuthStateChanged } = window.firebaseApp;

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      }
    });
  </script>

  <!-- Your Original Logic -->
  <script>
    const K = {
      keys: "ig_keywords",
      msg: "ig_message",
      leads: "ig_leads",
      clicks: "instagram_clicks"
    };

    function saveConfig(){
      localStorage.setItem(K.keys, document.getElementById("keywords").value);
      localStorage.setItem(K.msg, document.getElementById("message").value);
      alert("Saved ‚úÖ");
    }

    function getArr(key){
      return (localStorage.getItem(key) || "").toLowerCase().split(",").map(x=>x.trim()).filter(Boolean);
    }

    function inc(key){
      const v = Number(localStorage.getItem(key) || 0) + 1;
      localStorage.setItem(key, v);
    }

    function simulate(){
      const comment = document.getElementById("comment").value.toLowerCase();
      const user = document.getElementById("username").value || "@user";
      const keys = getArr(K.keys);
      const msg = localStorage.getItem(K.msg) || "";

      if(!keys.length || !msg){
        alert("Set keywords & message first");
        return;
      }

      const matched = keys.some(k => comment.includes(k));
      if(!matched){
        document.getElementById("result").innerHTML = "‚ùå No trigger matched. No DM sent.";
        return;
      }

      const leads = JSON.parse(localStorage.getItem(K.leads) || "[]");
      leads.push({ user, comment, time: new Date().toLocaleString() });
      localStorage.setItem(K.leads, JSON.stringify(leads));

      inc(K.clicks);

      document.getElementById("result").innerHTML =
        "‚úÖ DM sent to <b>" + user + "</b><br><span class='pill'>Message:</span> " + msg;

      renderLeads();
    }

    function renderLeads(){
      const leads = JSON.parse(localStorage.getItem(K.leads) || "[]");
      if(!leads.length){
        document.getElementById("leads").innerText = "No leads yet.";
        return;
      }
      document.getElementById("leads").innerHTML = leads
        .slice().reverse()
        .map(l => "‚Ä¢ " + l.user + " ‚Äî " + l.comment + " <span class='muted'>(" + l.time + ")</span>")
        .join("<br>");
    }

    document.getElementById("keywords").value = localStorage.getItem(K.keys) || "";
    document.getElementById("message").value = localStorage.getItem(K.msg) || "";
    renderLeads();
  </script>
</body>
</html>
